{% extends 'index_base.jinja2' %}

{% block content %}

    <div class=" ui big fluid action input">
        <input type="text" style="color: green" placeholder="Space seperated list of hostnames"
               id="whohosts_hostnames"/>
        <button class="ui button green" id="whohosts_button">Who hosts</button>
    </div>

    <div class="ui accordion">
        <div class=" title" id="show_more_settings">
            <i class="dropdown icon"></i>
            More settings
        </div>
        <div class=" content">

            <div class="field">
                <div class="ui labeled input fluid">
                    <div class="ui label">
                        DNS Server IPs
                    </div>
                    <input type="text" placeholder="(use default)" value="{{ dns_servers }}" id="dns_servers">
                </div>
            </div>
            <br>
            <div class="ui checkbox">
                <input type="checkbox" id="dns_query_all_servers" {% if dns_query_all_servers %} checked {% endif %}>
                <label>Query all DNS servers, not just first response</label>
            </div>
            <br>
            <br>
        </div>
    </div>

    <table class="ui celled compact table">
        <thead>
        <tr>
            <th><div class="ui  label teal">Cloud Provider</div></th>
            <th><div class="ui  label teal">Cloud Provider Range</th>
            <th><div class="ui  label blue">AS Holder</div></th>
            <th><div class="ui  label blue">ASN</div></th>
            <th><div class="ui  label blue">AS Prefix</div></th>
            <th><div class="ui label red">IP Address</div></th>
            <th><div class="ui label purple">DNS Responder</div></th>
            <th><div class="ui  label grey">Hostname</div></th>
        </tr>
        </thead>
        <tbody>
        {% if hosting_table is defined %}
            {% for hostname, host_details in hosting_table.items() %}
                <tr>
                  <td colspan="8"><div class="ui basic green label large">{{ hostname }}</div></td>
                </tr>
                {% if 'ip_info' in host_details and host_details['ip_info'] is not none %}
                    {% for ip_info in host_details['ip_info'] %}
                        <tr>
                            <td style="color: teal"> {% if ip_info["cloud_provider"] is not none%}{{ ip_info["cloud_provider"] }} {% else %} {% endif %}</td>
                            <td style="color: teal"> {% if ip_info["cloud_provider_prefix"] is not none%}{{ ip_info["cloud_provider_prefix"] }} {% else %} {% endif %} </td>
                            <td style="color: blue"> {{ ip_info["as_holder"] }} </td>
                            <td style="color: blue"> {{ ip_info["asn"] }} </td>
                            <td style="color: blue"> {{ ip_info["as_prefix"] }} </td>
                            <td style="color: red"> {{ ip_info["ip_address"] }} </td>
                            <td style="color: purple"> {{ ip_info["dns_responder"] }} </td>
                            <td style="color: grey">
                              {% if ip_info["dns_indirection"] is not none %}
                                  <div class="ui mini steps vertical">
                                  {% for dns_redirection in ip_info["dns_indirection"] %}
                                      <div class="step">
                                          <div class="content">
                                              <div class="title">{{ dns_redirection[0] }}</div>
                                              <div class="description">[{{ dns_redirection[1] }}] <i class="angle double right icon"></i> {{ dns_redirection[2] }}</div>
                                          </div>
                                      </div>
                                  {% endfor %}
                                  </div>
                              {% else %}
                                  {{ hostname }}
                              {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            {% endfor %}
        {% else %}
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        {% endif %}
        </tbody>
    </table>

{% endblock %}
